
<!DOCTYPE html>
<html>

<!-- Mirrored from rverhoeff7480.osisoft.int/piwebapi/help/topics/channels by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 20 Aug 2019 18:21:07 GMT -->
<head>
    <title>PI Web API</title>
    <link rel="stylesheet" type="text/css" href="https://rverhoeff7480.osisoft.int/piwebapi/admin/help/base.css" />
    <script type ="application/javascript" src="https://rverhoeff7480.osisoft.int/piwebapi/admin/help/style.js"></script>
    
</head>
<body>
    <header id="header">
        <a href="https://rverhoeff7480.osisoft.int/piwebapi/help">
            <img src="https://rverhoeff7480.osisoft.int/piwebapi/admin/help/logo.png" />
        </a>
        <h2>
            <a href="https://rverhoeff7480.osisoft.int/piwebapi/help" style="text-decoration: none">PI Web API Help</a>
        </h2>
        <h3>
            <a href="../getting-started.html">Getting Started</a>
        </h3>
        <h3 class="collapsible collapsed" onclick="toggleCollapse(this)"><span></span>Changelogs</h3>
        <ul>
                <li>
                    <a href="../changelog/pi-web-api.html">
                        PI Web API
                    </a>
                </li>
                <li>
                    <a href="../changelog/pi-web-api-indexed-search.html">
                        PI Web API Indexed Search
                    </a>
                </li>
        </ul>
        <h3 class="collapsible collapsed" onclick="toggleCollapse(this)"><span></span>Controllers</h3>
        <ul>
                <li>
                    <a href="../controllers/analysis.html">
                        Analysis
                    </a>
                </li>
                <li>
                    <a href="../controllers/analysiscategory.html">
                        AnalysisCategory
                    </a>
                </li>
                <li>
                    <a href="../controllers/analysisrule.html">
                        AnalysisRule
                    </a>
                </li>
                <li>
                    <a href="../controllers/analysisruleplugin.html">
                        AnalysisRulePlugIn
                    </a>
                </li>
                <li>
                    <a href="../controllers/analysistemplate.html">
                        AnalysisTemplate
                    </a>
                </li>
                <li>
                    <a href="../controllers/assetdatabase.html">
                        AssetDatabase
                    </a>
                </li>
                <li>
                    <a href="../controllers/assetserver.html">
                        AssetServer
                    </a>
                </li>
                <li>
                    <a href="../controllers/attribute.html">
                        Attribute
                    </a>
                </li>
                <li>
                    <a href="../controllers/attributecategory.html">
                        AttributeCategory
                    </a>
                </li>
                <li>
                    <a href="../controllers/attributetemplate.html">
                        AttributeTemplate
                    </a>
                </li>
                <li>
                    <a href="../controllers/attributetrait.html">
                        AttributeTrait
                    </a>
                </li>
                <li>
                    <a href="../controllers/batch.html">
                        Batch
                    </a>
                </li>
                <li>
                    <a href="../controllers/calculation.html">
                        Calculation
                    </a>
                </li>
                <li>
                    <a href="../controllers/channel.html">
                        Channel
                    </a>
                </li>
                <li>
                    <a href="../controllers/configuration.html">
                        Configuration
                    </a>
                </li>
                <li>
                    <a href="../controllers/dataserver.html">
                        DataServer
                    </a>
                </li>
                <li>
                    <a href="../controllers/element.html">
                        Element
                    </a>
                </li>
                <li>
                    <a href="../controllers/elementcategory.html">
                        ElementCategory
                    </a>
                </li>
                <li>
                    <a href="../controllers/elementtemplate.html">
                        ElementTemplate
                    </a>
                </li>
                <li>
                    <a href="../controllers/enumerationset.html">
                        EnumerationSet
                    </a>
                </li>
                <li>
                    <a href="../controllers/enumerationvalue.html">
                        EnumerationValue
                    </a>
                </li>
                <li>
                    <a href="../controllers/eventframe.html">
                        EventFrame
                    </a>
                </li>
                <li>
                    <a href="../controllers/home.html">
                        Home
                    </a>
                </li>
                <li>
                    <a href="../controllers/notificationcontacttemplate.html">
                        NotificationContactTemplate
                    </a>
                </li>
                <li>
                    <a href="../controllers/notificationplugin.html">
                        NotificationPlugIn
                    </a>
                </li>
                <li>
                    <a href="../controllers/notificationrule.html">
                        NotificationRule
                    </a>
                </li>
                <li>
                    <a href="../controllers/notificationrulesubscriber.html">
                        NotificationRuleSubscriber
                    </a>
                </li>
                <li>
                    <a href="../controllers/notificationruletemplate.html">
                        NotificationRuleTemplate
                    </a>
                </li>
                <li>
                    <a href="../controllers/point.html">
                        Point
                    </a>
                </li>
                <li>
                    <a href="../controllers/search.html">
                        Search
                    </a>
                </li>
                <li>
                    <a href="../controllers/securityidentity.html">
                        SecurityIdentity
                    </a>
                </li>
                <li>
                    <a href="../controllers/securitymapping.html">
                        SecurityMapping
                    </a>
                </li>
                <li>
                    <a href="../controllers/stream.html">
                        Stream
                    </a>
                </li>
                <li>
                    <a href="../controllers/streamset.html">
                        StreamSet
                    </a>
                </li>
                <li>
                    <a href="../controllers/system.html">
                        System
                    </a>
                </li>
                <li>
                    <a href="../controllers/table.html">
                        Table
                    </a>
                </li>
                <li>
                    <a href="../controllers/tablecategory.html">
                        TableCategory
                    </a>
                </li>
                <li>
                    <a href="../controllers/timerule.html">
                        TimeRule
                    </a>
                </li>
                <li>
                    <a href="../controllers/timeruleplugin.html">
                        TimeRulePlugIn
                    </a>
                </li>
                <li>
                    <a href="../controllers/unit.html">
                        Unit
                    </a>
                </li>
                <li>
                    <a href="../controllers/unitclass.html">
                        UnitClass
                    </a>
                </li>
        </ul>
        <h3 class="collapsible " onclick="toggleCollapse(this)"><span></span>Topics</h3>
        <ul>

                <li>
                    Core Services
                    <ul>
                            <li>
                                <a href="associations.html">
                                    Associations
                                </a>
                            </li>
                            <li>
                                <a href="attribute-trait.html">
                                    Attribute Trait
                                </a>
                            </li>
                            <li>
                                <a href="boundary-type.html">
                                    Boundary Type
                                </a>
                            </li>
                            <li>
                                <a href="buffer-option.html">
                                    Buffer Option
                                </a>
                            </li>
                            <li>
                                <a href="calculation-basis.html">
                                    Calculation Basis
                                </a>
                            </li>
                            <li>
                                <a href="channels.html">
                                    Channels
                                </a>
                            </li>
                            <li>
                                <a href="data-server-licenses.html">
                                    Data Server Licenses
                                </a>
                            </li>
                            <li>
                                <a href="element-type.html">
                                    Element Type
                                </a>
                            </li>
                            <li>
                                <a href="event-frame.html">
                                    Event Frame
                                </a>
                            </li>
                            <li>
                                <a href="export-mode.html">
                                    Export Mode
                                </a>
                            </li>
                            <li>
                                <a href="import-mode.html">
                                    Import Mode
                                </a>
                            </li>
                            <li>
                                <a href="include-mode.html">
                                    Include Mode
                                </a>
                            </li>
                            <li>
                                <a href="path-syntax.html">
                                    Path Syntax
                                </a>
                            </li>
                            <li>
                                <a href="performance-equations.html">
                                    Performance Equations
                                </a>
                            </li>
                            <li>
                                <a href="reference-type.html">
                                    Reference Type
                                </a>
                            </li>
                            <li>
                                <a href="retrieval-mode.html">
                                    Retrieval Mode
                                </a>
                            </li>
                            <li>
                                <a href="sample-type.html">
                                    Sample Type
                                </a>
                            </li>
                            <li>
                                <a href="search-field.html">
                                    Search Field
                                </a>
                            </li>
                            <li>
                                <a href="search-mode.html">
                                    Search Mode
                                </a>
                            </li>
                            <li>
                                <a href="search-operator.html">
                                    Search Operator
                                </a>
                            </li>
                            <li>
                                <a href="search-query-syntax.html">
                                    Search Query Syntax
                                </a>
                            </li>
                            <li>
                                <a href="security-item.html">
                                    Security Item
                                </a>
                            </li>
                            <li>
                                <a href="security-rights.html">
                                    Security Rights
                                </a>
                            </li>
                            <li>
                                <a href="selected-fields.html">
                                    Selected Fields
                                </a>
                            </li>
                            <li>
                                <a href="severity.html">
                                    Severity
                                </a>
                            </li>
                            <li>
                                <a href="sort-field.html">
                                    Sort Field
                                </a>
                            </li>
                            <li>
                                <a href="sort-order.html">
                                    Sort Order
                                </a>
                            </li>
                            <li>
                                <a href="stream.html">
                                    Stream
                                </a>
                            </li>
                            <li>
                                <a href="stream-updates.html">
                                    Stream Updates
                                </a>
                            </li>
                            <li>
                                <a href="summary-duration.html">
                                    Summary Duration
                                </a>
                            </li>
                            <li>
                                <a href="summary-type.html">
                                    Summary Type
                                </a>
                            </li>
                            <li>
                                <a href="supported-attribute-data-types.html">
                                    Supported Attribute Data Types
                                </a>
                            </li>
                            <li>
                                <a href="sync-time.html">
                                    Sync Time
                                </a>
                            </li>
                            <li>
                                <a href="time-strings.html">
                                    Time Strings
                                </a>
                            </li>
                            <li>
                                <a href="time-type.html">
                                    Time Type
                                </a>
                            </li>
                            <li>
                                <a href="time-zone.html">
                                    Time Zone
                                </a>
                            </li>
                            <li>
                                <a href="update-option.html">
                                    Update Option
                                </a>
                            </li>
                            <li>
                                <a href="user-identity.html">
                                    User Identity
                                </a>
                            </li>
                    </ul>
                </li>
                <li>
                    Global
                    <ul>
                            <li>
                                <a href="bearer-authentication.html">
                                    Bearer Authentication
                                </a>
                            </li>
                            <li>
                                <a href="cross-origin-resource-sharing.html">
                                    Cross-Origin Resource Sharing
                                </a>
                            </li>
                            <li>
                                <a href="dictionary-parameters.html">
                                    Dictionary Parameters
                                </a>
                            </li>
                            <li>
                                <a href="error-handling.html">
                                    Error Handling
                                </a>
                            </li>
                            <li>
                                <a href="impersonation-level.html">
                                    Impersonation Level
                                </a>
                            </li>
                            <li>
                                <a href="multipart-requests.html">
                                    Multipart Requests
                                </a>
                            </li>
                            <li>
                                <a href="query-string.html">
                                    Query String
                                </a>
                            </li>
                            <li>
                                <a href="run-state.html">
                                    Run State
                                </a>
                            </li>
                            <li>
                                <a href="url-encoding.html">
                                    URL Encoding
                                </a>
                            </li>
                            <li>
                                <a href="value-types.html">
                                    Value Types
                                </a>
                            </li>
                            <li>
                                <a href="webid.html">
                                    WebID
                                </a>
                            </li>
                            <li>
                                <a href="webid-type.html">
                                    WebID Type
                                </a>
                            </li>
                    </ul>
                </li>
                <li>
                    PI Web API Indexed Search
                    <ul>
                            <li>
                                <a href="common-error-codes.html">
                                    Common Error Codes
                                </a>
                            </li>
                            <li>
                                <a href="crawler-configuration.html">
                                    Crawler Configuration
                                </a>
                            </li>
                            <li>
                                <a href="crawler-finalizing-phases.html">
                                    Crawler Finalizing Phases
                                </a>
                            </li>
                            <li>
                                <a href="getting-started.html">
                                    Getting Started
                                </a>
                            </li>
                            <li>
                                <a href="search-queries.html">
                                    Search Queries
                                </a>
                            </li>
                    </ul>
                </li>
        </ul>
        <h3>
            <a href="http://livelibrary.osisoft.com/">PI Live Library</a>
        </h3>
    </header>
    <div id="content">
        
    <h2>Channels (Core Services)</h2>
<p>A channel is a way to receive continuous updates about a stream or stream set.
Rather than using a typical HTTP request, channels are accessed using the Web Socket protocol.
There are numerous Web Socket client libraries in several languages available for use with channels.</p>
<p>Channels use the &quot;wss://&quot; scheme instead of &quot;https://&quot; to indicate the use of secure Web Sockets.
Below are some examples of channel URLs:</p>
<ul>
<li>
<p>wss://myserver/piwebapi/streams/{webId}/channel</p>
</li>
<li>
<p>wss://myserver/piwebapi/streamsets/{webId}/channel</p>
</li>
<li>
<p>wss://myserver/piwebapi/streamsets/channel?webId={webId}</p>
</li>
</ul>
<p>Once connected, the server will send messages containing all the stream value changes since the last message. 
The payload of these messages is the same as the &quot;GetEnd&quot; method for streams and stream sets.
Any streams whose values have not changed since the last message will not be included in the message.
Value changes are not guaranteed to be sent in chronological order.</p>
<p>Below is an example of a channel message:</p>
<pre><code>{
    &quot;Links&quot;: {},
    &quot;Items&quot;: [
        {
            &quot;WebId&quot;: &quot;I1AbEDqD5loBNH0erqeqJodtALAaqQoQHk26BGgMQAVXYR0Ag8rvbPp_xUEC80vMunHcq2g&quot;,
            &quot;Name&quot;: &quot;Water&quot;,
            &quot;Links&quot;: {
                &quot;Self&quot;: &quot;https://myserver/piwebapi/attributes/I1AbEDqD5loBNH0erqeqJodtALAaqQoQHk26BGgMQAVXYR0Ag8rvbPp_xUEC80vMunHcq2g&quot;
            },
            &quot;UnitsAbbreviation&quot;: &quot;m&quot;,
            &quot;Items&quot;: [
                {
                    &quot;Timestamp&quot;: &quot;2014-07-22T14:00:00Z&quot;,
                    &quot;Value&quot;: 2.3,
                    &quot;Good&quot;: &quot;true&quot;,
                    &quot;Questionable&quot;: &quot;false&quot;,
                    &quot;Substituted&quot;: &quot;false&quot;
                },
                {
                    &quot;Timestamp&quot;: &quot;2014-07-22T15:00:00Z&quot;,
                    &quot;Value&quot;: 2.5,
                    &quot;Good&quot;: &quot;true&quot;,
                    &quot;Questionable&quot;: &quot;false&quot;,
                    &quot;Substituted&quot;: &quot;false&quot;
                }
            ]
        }
    ]
}
</code></pre>

<p>For PI Points and AF Attributes with PI Point Data Reference, 
channels will also send messages about modifications or deletions of previous values.
Modified values will have the &quot;Substituted&quot; flag set to true, 
and deleted values will have the &quot;Good&quot; flag set to false and a digital state of &quot;No Data&quot;.</p>
<h4>Polling Interval</h4>
<p>During operation, the Channel will periodically poll the PI System’s data update queue.
The interval between these polls is called the &quot;polling interval&quot;.
If there are any data updates detected while polling, PI Web API will send them to the client in a message.
The polling interval can be changed using the ChannelPollingInterval configuration value.</p>
<h4>Query Parameters</h4>
<p>If the URL parameter &quot;includeInitialValues&quot; is set to true, 
the server will send an initial message containing the current values of all the streams.
Below is an example:</p>
<ul>
<li>wss://myserver/piwebapi/streams/{webId}/channel?includeInitialValues=true</li>
</ul>
<p>If the URL parameter &quot;heartbeatRate&quot; is set, the Channel will periodically send an empty message
to confirm that the connection is still alive.
The &quot;heartbeatRate&quot; parameter is specified as an integer multiple of the polling interval.
After that many polling intervals without a data update, an empty message will be sent.
By default, no empty messages will be sent to the client.</p>
<p>Below is an example:</p>
<ul>
<li>wss://myserver/piwebapi/streams/{webId}/channel?heartbeatRate=5</li>
</ul>
<p>In this case, an empty message will be sent after every five polling intervals without a data update.</p>
<h4>Sample Clients</h4>
<p>Below are some sample clients for channels:</p>
<h4>Sample JavaScript Client (Requires Browser with support for Web Sockets)</h4>
<pre><code>var uri = &quot;wss://myserver/piwebapi/streams/{webId}/channel&quot;;

var webSocket = new WebSocket(uri);

webSocket.onopen = function(event)
{
    console.log(&quot;Connection opened.&quot;);
};

webSocket.onerror = function(event)
{
    console.log(&quot;Connection aborted.&quot;);
};

webSocket.onclose = function(event)
{
    console.log(&quot;Connection closed.&quot;);
};

webSocket.onmessage = function(event)
{
    console.log(&quot;Message received: &quot; + event.data);
};
</code></pre>

<h4>Sample C# Client (Requires .NET 4.0 or newer)</h4>
<pre><code>using System;
using System.Net.WebSockets;
using System.Text;
using System.Threading;
using System.Threading.Tasks;

public class Program
{
    public static void Main(string[] args)
    {
        Console.WriteLine(&quot;Press any key to close.&quot;);

        CancellationTokenSource cancellationSource = new CancellationTokenSource();

        Task runTask = RunClient(cancellationSource.Token);

        Console.ReadKey();

        cancellationSource.Cancel();

        runTask.Wait();
    }

    public static async Task RunClient(CancellationToken cancellationToken)
    {
        Uri uri = new Uri(&quot;wss://myserver/piwebapi/streams/{webId}/channel&quot;);

        WebSocketReceiveResult receiveResult;
        byte[] receiveBuffer = new byte[65536];
        ArraySegment&lt;byte&gt; receiveSegment = new ArraySegment&lt;byte&gt;(receiveBuffer);

        using (ClientWebSocket webSocket = new ClientWebSocket())
        {
            try
            {
                await webSocket.ConnectAsync(uri, CancellationToken.None);
            }
            catch (WebSocketException)
            {
                Console.WriteLine(&quot;Could not connect to server.&quot;);
                return;
            }

            while (true)
            {
                try
                {
                    receiveResult = await webSocket.ReceiveAsync(receiveSegment, cancellationToken);
                }
                catch (OperationCanceledException)
                {
                    break;
                }

                if (receiveResult.MessageType != WebSocketMessageType.Text)
                {
                    await webSocket.CloseAsync(
                        WebSocketCloseStatus.InvalidMessageType,
                        &quot;Message type is not text.&quot;, 
                        CancellationToken.None);
                    return;
                }
                else if (receiveResult.Count &gt; receiveBuffer.Length)
                {
                    await webSocket.CloseAsync(
                        WebSocketCloseStatus.InvalidPayloadData,
                        &quot;Message is too long.&quot;, 
                        CancellationToken.None);
                    return;
                }

                string message = Encoding.UTF8.GetString(receiveBuffer, 0, receiveResult.Count);

                Console.WriteLine(message);
            }

            await webSocket.CloseAsync(
                WebSocketCloseStatus.NormalClosure, 
                &quot;Closing connection.&quot;, 
                CancellationToken.None);
        }
    }
}
</code></pre>


        
    </div>
</body>

<!-- Mirrored from rverhoeff7480.osisoft.int/piwebapi/help/topics/channels by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 20 Aug 2019 18:21:07 GMT -->
</html>
